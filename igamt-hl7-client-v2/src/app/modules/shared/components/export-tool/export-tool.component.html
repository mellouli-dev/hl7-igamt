<h2 mat-dialog-title>Export To Validation Tool</h2>
<div class="dialog-container">
  <div *ngIf="step === 2 && !verificationInProgress && !verificationFailed && !hasFatal && !hasErrors" class="alert alert-success">
    Your selected profile(s) have passed the verification.
  </div>
  <div *ngIf="step === 2 && !verificationInProgress && !verificationFailed && hasFatal" class="alert alert-danger">
    Your selected profile(s) have fatal errors, please fix your profiles and try again.
  </div>
  <div *ngIf="step === 2 && !verificationInProgress && !verificationFailed && !hasFatal && hasErrors" class="alert alert-danger">
    Your selected profile(s) have errors, please fix your profiles.
  </div>
  <div *ngIf="step === 1 && verificationFailed" class="alert alert-danger">
    {{verificationErrorMessage}}
  </div>
  <div class="alerts">
    <app-dam-alerts-container></app-dam-alerts-container>
  </div>
  <form #loginForm='ngForm'>
    <ng-container *ngIf="step === 0">
      <p-dropdown [options]="data.tools" [(ngModel)]="tool" optionLabel="label" placeholder="Select tool" required name="tool" id="tool" [style]="{'minWidth':'100%', 'margin-bottom': '20px'}"></p-dropdown>
      <div class="form-group">
        <div class="input-group">
          <div class="input-group-prepend">
            <span class="input-group-text" style="width: 40px;"> <i class="fa fa-user"></i> </span>
          </div>
          <input class="form-control" [disabled]="!tool" id="username"  name="username" placeholder="Username" [(ngModel)]="username"  type="username" required>
        </div>
      </div>
      <div class="form-group">
        <div class="input-group">
          <div class="input-group-prepend">
            <span class="input-group-text" style="width: 40px;"> <i class="fa fa-key"></i> </span>
          </div>
          <input class="form-control" id="password" [disabled]="!tool"  name="password" [(ngModel)]="password" placeholder="password" type="password" required>
        </div>
      </div>
    </ng-container>
  </form>
  <ng-container *ngIf="step === 1">
    <label> <strong> Select Tool Scope </strong> </label>
    <p-dropdown [options]="domains" required [ngModel]="selectedToolScope" (ngModelChange)="selectDomain($event)" optionLabel="name" placeholder="Select Tool Scopes" [style]="{'minWidth':'100%', 'margin-bottom': '10px;'}"></p-dropdown>
    <br/>
    <label> <strong> Select Conformance Profiles </strong> </label>
    <app-select-resource-ids [resources]="data.conformanceProfiles" (selected)="selectConformanceProfiles($event)"></app-select-resource-ids>
    <br/>
    <label> <strong> Select Composite Profiles </strong> </label>
    <app-select-resource-ids [resources]="data.compositeProfiles" (selected)="selectCompositeProfiles($event)"></app-select-resource-ids>
  </ng-container>

  <div *ngIf="step === 2" style="overflow: hidden;">
    <div *ngIf="verificationInProgress" style="display: flex; align-items: center; justify-content: center; flex-direction:  column;">
        <span>Please wait while we verify your profiles</span>
        <div style="margin-top: 40px;">
          <mat-spinner class="verification-progress" diameter="50"></mat-spinner>
        </div>
    </div>
    <div *ngIf="!verificationInProgress && verificationResult" class="report-container">
      <div style="padding: 10px; border-radius: 4px;border: 1px solid lightgray;background: #f7f7f7;">
        <div><app-issue-badge type="FATAL" label="FATAL"></app-issue-badge> - IGAMT cannot generate the XML; Downstream tools would not be able to process XML.</div>
        <div><app-issue-badge type="ERROR" label="ERROR"></app-issue-badge> - IGAMT can generate the XML; User should fix errors before exporting the XML and using downstream tools.</div>
        <div><app-issue-badge type="WARNING" label="WARNING"></app-issue-badge>  - User should consider providing correct values; Not necessary for downstream tools process.</div>
        <div><app-issue-badge type="INFORMATIONAL" label="INFORMATIONAL"></app-issue-badge> - User should consider changing the value.</div>
      </div>
      <div style="overflow: hidden; width: 80vw;">
        <app-verification-result-display [verificationResult]="verificationResult" [activeSelector]="activeSelector" [showEmpty]="false"></app-verification-result-display>
      </div>
    </div>
  </div>

  <ng-container *ngIf="step === 3">
    <div *ngIf="exportInProgress" style="display: flex; align-items: center; justify-content: center; flex-direction:  column;">
      <span>Please wait while we export your profiles to {{tool.label}}</span>
      <div style="margin-top: 40px;">
        <mat-spinner class="verification-progress" diameter="50"></mat-spinner>
      </div>
    </div>
    <div *ngIf="redirectUrl" class="alert alert alert-success">
      Profile successfully pushed to: <br><a [href]="redirectUrl" target="_blank">{{redirectUrl}}</a>
    </div>
    <div *ngIf="exportFailed" style="overflow: hidden; height: 100%; display: flex; flex-direction: column; gap: 10px;">
      <div *ngIf="exportError" class="alert alert alert-danger">
        {{exportError}}
      </div>
      <div *ngIf="HTMLErrorReport || !exportError" class="alert alert alert-danger">
        Errors were encountered while exporting profiles.
      </div>
      <div *ngIf="HTMLErrorReport" style="margin-top: 5px; min-width: 800px; overflow: scroll; height: 100%;" [innerHTML]="HTMLErrorReport"></div>
    </div>
  </ng-container>
</div>


<mat-dialog-actions style="justify-content: flex-end;">
  <button (click)="back()" *ngIf="step !== 0 && step !== 3 && !verificationInProgress && !exportInProgress" class="btn btn-sm btn-primary" style="margin-right: 5px;">Back</button>
  <button (click)="loadDomain()" *ngIf="step === 0" [disabled]="!loginForm.valid" class="btn btn-sm btn-success" type="submit">Login</button>
  <button *ngIf="step === 1" (click)="verify()" [disabled]="!isSelected()" class="btn btn-sm btn-success">Next</button>
  <button *ngIf="step === 2 && !hasFatal && !hasErrors && !verificationInProgress && !exportInProgress" (click)="submit()" [disabled]="!isSelected()" class="btn btn-sm btn-success">Next</button>
  <button *ngIf="step === 2 && !hasFatal && hasErrors && !verificationInProgress && !exportInProgress" (click)="submit()" [disabled]="!isSelected()" class="btn btn-sm btn-warning">Proceed anyway</button>
  <button *ngIf="step === 3 && !verificationInProgress && !exportInProgress" (click)="cancel()" class="btn btn-sm btn-danger">Close</button>
  <button *ngIf="step !== 3 && !verificationInProgress && !exportInProgress" (click)="cancel()" class="btn btn-sm btn-danger" style="margin-left: 5px;">Cancel</button>
</mat-dialog-actions>
